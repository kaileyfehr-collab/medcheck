<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Medication Check</title>
  <style>
    :root {
      --bg: #0b1020;
      --card: rgba(255,255,255,0.08);
      --text: #eef2ff;
      --muted: rgba(238,242,255,0.7);
      --border: rgba(255,255,255,0.14);
      --shadow: 0 18px 50px rgba(0,0,0,.35);
      --radius: 18px;

      /* Medication colors */
      --aqua: #22c55e;   /* Aquaphor */
      --med:  #3b82f6;   /* Medication */
      --taken: #22c55e;  /* Taken button green */
      --btn: rgba(255,255,255,0.12);
      --btnHover: rgba(255,255,255,0.18);
    }

    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text);
      background:
        radial-gradient(1200px 600px at 20% 0%, rgba(59,130,246,.25), transparent 60%),
        radial-gradient(1200px 600px at 80% 20%, rgba(34,197,94,.20), transparent 60%),
        radial-gradient(900px 500px at 50% 100%, rgba(236,72,153,.10), transparent 60%),
        var(--bg);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .wrap { width: 100%; max-width: 520px; }
    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
      backdrop-filter: blur(10px);
    }

    header { padding: 22px 22px 14px; border-bottom: 1px solid var(--border); }
    h1 { margin: 0; font-size: 22px; letter-spacing: 0.2px; }
    .sub { margin-top: 6px; color: var(--muted); font-size: 13px; line-height: 1.35; }

    .content { padding: 18px 22px 22px; display: grid; gap: 14px; }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.06);
    }

    .dot { width: 12px; height: 12px; border-radius: 999px; background: var(--muted); }
    .pill b { font-size: 14px; }
    .pill span { color: var(--muted); font-size: 13px; }

    .statusRow { display: flex; flex-wrap: wrap; gap: 10px; align-items: center; justify-content: space-between; }
    .statusRow .left { display: flex; flex-wrap: wrap; gap: 10px; align-items: center; }
    .dateTag { color: var(--muted); font-size: 13px; }

    .big {
      border-radius: var(--radius);
      border: 1px solid var(--border);
      background: rgba(0,0,0,0.18);
      padding: 16px;
      display: grid;
      gap: 8px;
    }
    .big .label { color: var(--muted); font-size: 12px; letter-spacing: .06em; text-transform: uppercase; }
    .big .value { font-size: 26px; font-weight: 750; display: flex; align-items: center; gap: 10px; }

    .btn {
      width: 100%;
      border: 1px solid var(--border);
      background: var(--btn);
      color: var(--text);
      border-radius: 16px;
      padding: 14px 14px;
      font-size: 15px;
      font-weight: 650;
      cursor: pointer;
      transition: transform .05s ease, background .15s ease, border-color .15s ease;
      user-select: none;
    }
    .btn:hover { background: var(--btnHover); }
    .btn:active { transform: scale(0.99); }
    .btn.taken {
      background: rgba(34,197,94,0.22);
      border-color: rgba(34,197,94,0.55);
      color: #eafff2;
    }

    .history {
      border-radius: 16px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.05);
      padding: 14px;
    }
    .history h2 { margin: 0 0 10px; font-size: 14px; color: var(--muted); font-weight: 700; letter-spacing: .02em; }
    .history ul { list-style: none; padding: 0; margin: 0; display: grid; gap: 8px; }
    .history li {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(0,0,0,0.12);
      font-size: 13px;
      color: var(--muted);
    }
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 700;
      color: #0b1020;
      background: rgba(255,255,255,0.9);
    }
    .badge.a { background: rgba(34,197,94,0.95); }
    .badge.b { background: rgba(59,130,246,0.95); }

    footer { padding: 14px 22px 18px; color: rgba(238,242,255,0.45); font-size: 12px; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <header>
        <h1>Medication Check</h1>
        <div class="sub">Scan your NFC tag to see what to take today.</div>
      </header>

      <div class="content">
        <div class="statusRow">
          <div class="left">
            <div class="pill" id="dayPill">
              <span class="dot" id="dayDot"></span>
              <div>
                <b id="dayText">Day 1 of 3</b><br />
                <span id="todayText">Today: Aquaphor</span>
              </div>
            </div>
          </div>
          <div class="dateTag" id="dateTag"></div>
        </div>

        <div class="big" id="medCard">
          <div class="label">Take</div>
          <div class="value" id="medValue">Aquaphor</div>
        </div>

        <button class="btn" id="takenBtn">Taken?</button>

        <div class="history">
          <h2>History (saved on this phone)</h2>
          <ul id="historyList"></ul>
        </div>
      </div>

      <footer>
        Pattern repeats every 3 days: Aquaphor, Aquaphor, Medication.
      </footer>
    </div>
  </div>

<script>
(() => {
  const STORAGE_KEY_START = "medCheck_cycleStartISO";
  const STORAGE_KEY_TAKEN = "medCheck_takenByDate";
  const STORAGE_KEY_HISTORY = "medCheck_history";

  const dayText = document.getElementById("dayText");
  const todayText = document.getElementById("todayText");
  const medValue = document.getElementById("medValue");
  const dayDot = document.getElementById("dayDot");
  const dateTag = document.getElementById("dateTag");
  const medCard = document.getElementById("medCard");
  const takenBtn = document.getElementById("takenBtn");
  const historyList = document.getElementById("historyList");

  const MED_A = "Aquaphor";   // 2 days in a row
  const MED_B = "Medication"; // 1 day

  // ---- Helpers ----
  const pad2 = n => String(n).padStart(2,"0");
  const ymd = (d) => `${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())}`;
  const parseISODate = (iso) => {
    // stored as YYYY-MM-DD
    const [y,m,dd] = iso.split("-").map(Number);
    return new Date(y, m-1, dd);
  };
  const startOfToday = () => {
    const d = new Date();
    d.setHours(0,0,0,0);
    return d;
  };
  const daysBetween = (a,b) => Math.floor((b - a) / 86400000);

  const getStart = () => {
    const saved = localStorage.getItem(STORAGE_KEY_START);
    if (saved) return parseISODate(saved);

    // First time: set start to today automatically
    const t = startOfToday();
    localStorage.setItem(STORAGE_KEY_START, ymd(t));
    return t;
  };

  const getTakenMap = () => {
    try { return JSON.parse(localStorage.getItem(STORAGE_KEY_TAKEN) || "{}"); }
    catch { return {}; }
  };
  const setTakenMap = (obj) => localStorage.setItem(STORAGE_KEY_TAKEN, JSON.stringify(obj));

  const getHistory = () => {
    try { return JSON.parse(localStorage.getItem(STORAGE_KEY_HISTORY) || "[]"); }
    catch { return []; }
  };
  const setHistory = (arr) => localStorage.setItem(STORAGE_KEY_HISTORY, JSON.stringify(arr));

  // ---- Core cycle logic ----
  function cycleInfo() {
    const start = getStart();
    const today = startOfToday();
    const delta = daysBetween(start, today);

    // day index 0,1,2 repeating
    const idx = ((delta % 3) + 3) % 3;
    const dayNum = idx + 1;

    const med = (idx === 2) ? MED_B : MED_A;
    const badgeClass = (idx === 2) ? "b" : "a";

    return { start, today, idx, dayNum, med, badgeClass };
  }

  function render() {
    const { today, dayNum, med, badgeClass } = cycleInfo();

    // Date display
    const pretty = today.toLocaleDateString(undefined, { weekday: "long", year: "numeric", month: "short", day: "numeric" });
    dateTag.textContent = `Today is ${pretty}`;

    // Day + medication
    dayText.textContent = `Day ${dayNum} of 3`;
    todayText.textContent = `Today: ${med}`;
    medValue.textContent = med;

    // Color accents (Aquaphor = green, Medication = blue)
    const dotColor = (badgeClass === "a") ? "var(--aqua)" : "var(--med)";
    dayDot.style.background = dotColor;
    medCard.style.borderColor = (badgeClass === "a") ? "rgba(34,197,94,0.35)" : "rgba(59,130,246,0.35)";
    medCard.style.background = (badgeClass === "a") ? "rgba(34,197,94,0.10)" : "rgba(59,130,246,0.10)";

    // Taken state for today
    const takenMap = getTakenMap();
    const key = ymd(today);
    const isTaken = !!takenMap[key];

    takenBtn.classList.toggle("taken", isTaken);
    takenBtn.textContent = isTaken ? "Taken âœ“" : "Taken?";

    renderHistory();
  }

  function renderHistory() {
    const history = getHistory();
    historyList.innerHTML = "";

    if (!history.length) {
      const li = document.createElement("li");
      li.textContent = "No entries yet.";
      historyList.appendChild(li);
      return;
    }

    // newest first
    for (const entry of history.slice().reverse()) {
      const li = document.createElement("li");

      const left = document.createElement("div");
      left.textContent = entry.datePretty;

      const badge = document.createElement("div");
      badge.className = `badge ${entry.badgeClass}`;
      badge.textContent = entry.med;

      li.appendChild(left);
      li.appendChild(badge);
      historyList.appendChild(li);
    }
  }

  function markTakenToday() {
    const { today, med, badgeClass } = cycleInfo();
    const key = ymd(today);

    const takenMap = getTakenMap();
    if (takenMap[key]) return; // already taken today

    takenMap[key] = true;
    setTakenMap(takenMap);

    // Save to history (on this phone)
    const pretty = today.toLocaleDateString(undefined, { year: "numeric", month: "short", day: "numeric" });
    const datePretty = `${pretty}`;

    const history = getHistory();
    history.push({
      dateISO: key,
      datePretty,
      med,
      badgeClass,
      ts: Date.now()
    });
    setHistory(history);

    render();
  }

  takenBtn.addEventListener("click", markTakenToday);

  // Initial render
  render();
})();
</script>
</body>
</html>
